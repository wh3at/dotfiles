if [ -f ~/.profile ]; then
    source ~/.profile
fi

# Lines configured by zsh-newuser-install
HISTFILE=~/.histfile
HISTSIZE=1000
SAVEHIST=1000
bindkey -e
# End of lines configured by zsh-newuser-install

# The following lines were added by compinstall
zstyle :compinstall filename '/home/ubuntu/.zshrc'

autoload -Uz compinit
compinit
# End of lines added by compinstall

# Added by Zinit's installer
if [[ ! -f $HOME/.local/share/zinit/zinit.git/zinit.zsh ]]; then
    print -P "%F{33} %F{220}Installing %F{33}ZDHARMA-CONTINUUM%F{220} Initiative Plugin Manager (%F{33}zdharma-continuum/zinit%F{220})…%f"
    command mkdir -p "$HOME/.local/share/zinit" && command chmod g-rwX "$HOME/.local/share/zinit"
    command git clone https://github.com/zdharma-continuum/zinit "$HOME/.local/share/zinit/zinit.git" && \
        print -P "%F{33} %F{34}Installation successful.%f%b" || \
        print -P "%F{160} The clone has failed.%f%b"
fi

source "$HOME/.local/share/zinit/zinit.git/zinit.zsh"
autoload -Uz _zinit
(( ${+_comps} )) && _comps[zinit]=_zinit
# End of Zinit's installer chunk

# Zinit's config
## プロンプトテーマ sindresorhus/pure
zi ice pick"async.zsh" src"pure.zsh"
zi light sindresorhus/pure
## インタラクティブな補完
zinit light zsh-users/zsh-autosuggestions
## シンタックスハイライト
zinit light zdharma-continuum/fast-syntax-highlighting
# End of Zinit's config

# Mise activate
eval "$(mise activate zsh)"

# PATH
export PATH="$HOME/.local/share/mise/shims:$PATH"
export BUN_INSTALL="$HOME/.bun"
export PATH="$BUN_INSTALL/bin:$PATH"
export PNPM_HOME="$HOME/.local/share/pnpm"
[[ ":$PATH:" != *":$PNPM_HOME:"* ]] && export PATH="$PATH:$PNPM_HOME"
if [ -f /home/linuxbrew/.linuxbrew/bin/brew ]; then
  eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
fi
export PATH="$PATH:$HOME/apps"
export PATH="$PATH:$HOME/.remote-code/bin"
export PATH="$HOME/.local/bin:$PATH"
export ANDROID_SDK_ROOT="$HOME/Android/Sdk"
export ANDROID_NDK_HOME="$ANDROID_SDK_ROOT/ndk/27.3.13750724"
export ANDROID_HOME="$ANDROID_SDK_ROOT"

# 1Password
export OP_SERVICE_ACCOUNT_TOKEN="{{ .one_password.service_acc_token }}"

if command -v op &> /dev/null; then
  eval "$(op completion zsh)"; compdef _op op
fi

# Cargo
if [ -f "$HOME/.cargo/env" ]; then
  . "$HOME/.cargo/env"
fi

# Phantom
if command -v phantom &> /dev/null; then
  eval "$(phantom completion zsh)"
fi

# Functions
function google() {
  gemini -p "指定したクエリを検索し、要約して。<query>$1</query>"
}

# Alias
alias cl="clear"
alias cx="codex"
alias zll="zellij"
alias zla="zellij a"
alias ..="cd ../"
alias ...="cd ../../"
alias cc="claude"
alias ccd="claude --dangerously-skip-permissions"
alias glm="ANTHROPIC_BASE_URL='{{ .z_ai.endpoint }}' ANTHROPIC_AUTH_TOKEN='{{ .z_ai.api_key }}' claude --dangerously-skip-permissions"
alias mr="mise run"
alias phc="phantom create"
alias phd="phantom delete"
alias phs="phantom shell"
alias python="python3"

# bun completions
[ -s "$HOME/.bun/_bun" ] && source "$HOME/.bun/_bun"

# pnpm completions
if command -v pnpm &> /dev/null; then
  eval "$(pnpm completion zsh)"; compdef _pnpm pnpm
fi

# neovim
if [ -f "$HOME/apps/nvim-linux-arm64.appimage" ]; then
  alias nvim="$HOME/apps/nvim-linux-arm64.appimage"
fi

# Zellij custom
zll_new_git_wt() {
  # zellij 内でなければ終了
  if [ -z "${ZELLIJ-}" ]; then
    echo 'zj_new_tab: must be run inside zellij' >&2
    return 1
  fi

  # ブランチ名を受け取る
  local name="$1"

  if [ -z "$name" ]; then
    printf 'tab name: '
    read -r name || return 1
  fi

  [ -z "$name" ] && return 1

  phantom create "feature/$name"

  # Layout の作業領域が2ペイン前提
  local cwd="$PWD"
  zellij action new-tab --name "$name" --layout main --cwd "$cwd"

  zellij action write-chars "phantom shell feature/$name"
  zellij action write 13

  zellij action focus-next-pane
  zellij action write-chars "phantom shell feature/$name"
  zellij action write 13

  zellij action focus-previous-pane
  zellij action write-chars "codex"
  zellij action write 13
}
